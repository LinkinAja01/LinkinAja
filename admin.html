<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | LinkinAja</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f4f4; color: #333; }
    header { background-color: #0fb310; color: white; padding: 15px; text-align: center; position: sticky; top: 0; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    form { background: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    form input, form select, form textarea { width: 100%; padding: 10px; margin-top: 10px; margin-bottom: 20px; border-radius: 5px; border: 1px solid #ccc; }
    form button { background-color: #0fb310; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #e8f5e9; }
    .btn-edit { background: #2196F3; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    .btn-delete { background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_Et5wLL9Zk24Ewc-43mTG4DP-PblvPGY",
      authDomain: "linkinaja-23a4b.firebaseapp.com",
      projectId: "linkinaja-23a4b",
      storageBucket: "linkinaja-23a4b.appspot.com",
      messagingSenderId: "575411635239",
      appId: "1:575411635239:web:c8ff9067b78d57f92d7a02",
      measurementId: "G-F6LRLD1EYE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore();
    const produkRef = collection(db, "produk");

    let editMode = false;
    let editId = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      document.getElementById('productForm').addEventListener('submit', handleFormSubmit);
    });

    async function loadProducts() {
      const snapshot = await getDocs(produkRef);
      const tbody = document.getElementById('productList');
      tbody.innerHTML = '';
      snapshot.forEach(docSnap => {
        const p = docSnap.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.nama}</td>
          <td>${p.toko}</td>
          <td>${p.kategori}</td>
          <td>Rp${p.harga.toLocaleString()}</td>
          <td><button class='btn-edit' onclick="editProduct('${docSnap.id}', '${p.nama}', '${p.toko}', '${p.kategori}', '${p.harga}', '${p.deskripsi}', '${p.gambar}', ${p.rating})">Edit</button> 
              <button class='btn-delete' onclick="deleteProduct('${docSnap.id}')">Hapus</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.editProduct = (id, nama, toko, kategori, harga, deskripsi, gambar, rating) => {
      document.getElementById('nama').value = nama;
      document.getElementById('toko').value = toko;
      document.getElementById('kategori').value = kategori;
      document.getElementById('harga').value = harga;
      document.getElementById('deskripsi').value = deskripsi;
      document.getElementById('gambar').value = gambar;
      document.getElementById('rating').value = rating;
      editMode = true;
      editId = id;
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      const data = {
        nama: nama.value,
        toko: toko.value,
        kategori: kategori.value,
        harga: Number(harga.value),
        deskripsi: deskripsi.value,
        gambar: gambar.value,
        rating: Number(rating.value)
      };
      if(editMode) {
        if(confirm('Yakin update produk ini?')) {
          await updateDoc(doc(db, "produk", editId), data);
          alert('Produk berhasil diupdate!');
        }
      } else {
        await addDoc(produkRef, data);
        alert('Produk berhasil ditambahkan!');
      }
      document.getElementById('productForm').reset();
      editMode = false;
      editId = null;
      loadProducts();
    }

    window.deleteProduct = async (id) => {
      if(confirm('Yakin hapus produk ini?')) {
        await deleteDoc(doc(db, "produk", id));
        alert('Produk dihapus.');
        loadProducts();
      }
    }
  </script>
</head>
<body>
  <header>
    <h1>Admin Panel - LinkinAja</h1>
  </header>
  <div class="container">
    <form id="productForm">
      <h2>Tambah / Edit Produk</h2>
      <input type="text" id="nama" placeholder="Nama Produk" required />
      <select id="toko" required>
        <option value="">Pilih Toko</option>
        <option value="Shopee">Shopee</option>
        <option value="Tokopedia">Tokopedia</option>
        <option value="Lazada">Lazada</option>
        <option value="Blibli">Blibli</option>
        <option value="Bukalapak">Bukalapak</option>
        <option value="Akulaku">Akulaku</option>
        <option value="Alibaba">Alibaba</option>
        <option value="TiktokShop">TiktokShop</option>
      </select>
      <select id="kategori" required>
        <option value="">Pilih Kategori</option>
        <option value="Elektronik">Elektronik</option>
        <option value="Gadget">Gadget</option>
        <option value="Komputer">Komputer</option>
        <option value="Fashion">Fashion</option>
        <option value="Kesehatan">Kesehatan</option>
        <option value="Kecantikan">Kecantikan</option>
        <option value="Peralatan Bayi">Peralatan Bayi</option>
        <option value="Peralatan Rumah Tangga">Peralatan Rumah Tangga</option>
      </select>
      <input type="number" id="harga" placeholder="Harga" required />
      <textarea id="deskripsi" placeholder="Deskripsi" required></textarea>
      <input type="text" id="gambar" placeholder="Link Gambar" required />
      <input type="number" id="rating" placeholder="Rating (1-5)" min="1" max="5" required />
      <button type="submit">Simpan Produk</button>
    </form>

    <h2>Daftar Produk</h2>
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>Toko</th>
          <th>Kategori</th>
          <th>Harga</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="productList"></tbody>
    </table>
  </div>
</body>
</html>